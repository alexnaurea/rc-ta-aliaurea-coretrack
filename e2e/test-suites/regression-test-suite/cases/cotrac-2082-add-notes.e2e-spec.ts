import { StepLogger } from '../../../../core/logger/step-logger';
import { PageHelper } from '../../../components/html/page-helper';
import { LoginPageHelper } from '../../../page-objects/pages/login-page/login-page.helper';
import { NewCasePageConstant } from '../../../page-objects/pages/new-case-page/new-case-page.constants';
import { NewCasePageHelper } from '../../../page-objects/pages/new-case-page/new-case-page.helper';
import { SuiteNames } from '../../helpers/suite-names';

describe(SuiteNames.regressionSuite, () => {
    let loginPageHelper: LoginPageHelper;
    const subject = `${NewCasePageConstant.elementNames.test}${PageHelper.getUniqueId()}${PageHelper.getUniqueId()}`;
    const note = `${NewCasePageConstant.elementNames.test}${PageHelper.getUniqueId()}${PageHelper.getUniqueId()}`;

    beforeAll(async () => {
        loginPageHelper = LoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
    });

    beforeEach(async () => {
        await PageHelper.restartBrowser();
        await loginPageHelper.goTo();
        await LoginPageHelper.loginAsAdmin();
    });

    // Jira References - COTRAC-4105
    it('To verify that user is able to search for cases for a contact. - [22952470]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 08:02:19 GMT
        StepLogger.caseId = 22952470;

        StepLogger.preCondition('Create a case');
        await NewCasePageHelper.navigateToCasesAndCreateCase(subject);

        StepLogger.stepId(1);
        StepLogger.step('Click global search text box and select case in the filter.');
        await NewCasePageHelper.selectCasesInSearch();
        StepLogger.verification('It should be selected.');
        await NewCasePageHelper.verifyCasesSelectedInSearch();

        StepLogger.stepId(2);
        StepLogger.step('Enter the search text.');
        await NewCasePageHelper.enterSearchText(subject, false);
        StepLogger.verification('It should be entered.');
        await NewCasePageHelper.verifySearchText(subject);

        StepLogger.stepId(3);
        StepLogger.step('Click "search" button.');
        await NewCasePageHelper.clickSearchTextButton();
        StepLogger.verification('All the cases related to text entered should be displayed.');
        await NewCasePageHelper.verifyCasesListDisplayed();
    });

    // Jira References - COTRAC-4100
    it('To verify that user is able to open the details of the selected case. - [22952471]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 08:18:31 GMT
        StepLogger.caseId = 22952471;

        StepLogger.stepId(1);
        StepLogger.step('Click global search text box and select case in the filter.');
        await NewCasePageHelper.selectCasesInSearch();
        StepLogger.verification('It should be selected.');
        await NewCasePageHelper.verifyCasesSelectedInSearch();

        StepLogger.stepId(2);
        StepLogger.step('Enter the search text and click search button.');
        await NewCasePageHelper.enterSearchText(subject);
        StepLogger.verification('All the cases related to text entered should be displayed.');
        await NewCasePageHelper.verifyCasesListDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Select a case from the displayed list.');
        await NewCasePageHelper.clickFirstCard();
        StepLogger.verification('The details of the selected case should be displayed.');
        await NewCasePageHelper.verifyReviewCasePageDisplayed(subject);
    });

    // Jira References - COTRAC-4106
    it('To verify the title of the opened case. - [22952472]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 08:22:59 GMT
        StepLogger.caseId = 22952472;

        StepLogger.stepId(1);
        StepLogger.step('Click global search text box and select case in the filter.');
        await NewCasePageHelper.selectCasesInSearch();
        StepLogger.verification('It should be selected.');
        await NewCasePageHelper.verifyCasesSelectedInSearch();

        StepLogger.stepId(2);
        StepLogger.step('Enter the search text and click search button.');
        await NewCasePageHelper.enterSearchText(subject);
        StepLogger.verification('All the cases related to text entered should be displayed.');
        await NewCasePageHelper.verifyCasesListDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Select a case from the displayed list.');
        const title = await NewCasePageHelper.clickFirstCard();
        StepLogger.verification('The details of the selected case should be displayed.');
        await NewCasePageHelper.verifyReviewCasePageDisplayed(subject, false);

        StepLogger.stepId(4);
        StepLogger.step('Verify the case title.');
        StepLogger.verification('It should be" Case #number : subject "');
        await NewCasePageHelper.verifyCaseNumberAndSubject( title.name, title.id);
    });

    // Jira References - COTRAC-4101
    it('Verify that user is able to access Notes tab for a case. - [22952475]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 08:44:06 GMT
        StepLogger.caseId = 22952475;

        StepLogger.stepId(1);
        StepLogger.step('Click global search text box and select case in the filter.');
        await NewCasePageHelper.selectCasesInSearch();
        StepLogger.verification('It should be selected.');
        await NewCasePageHelper.verifyCasesSelectedInSearch();

        StepLogger.stepId(2);
        StepLogger.step('Enter the search text and click search button.');
        await NewCasePageHelper.enterSearchText(subject);
        StepLogger.verification('All the cases related to text entered should be displayed.');
        await NewCasePageHelper.verifyCasesListDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Select a case from the displayed list.');
        await NewCasePageHelper.clickFirstCard();
        StepLogger.verification('The details of the selected case should be displayed.');
        await NewCasePageHelper.verifyReviewCasePageDisplayed(subject, false);

        StepLogger.stepId(4);
        StepLogger.step('Go to Notes tab.');
        await NewCasePageHelper.clickNotesTab();
        StepLogger.verification('Notes page should be displayed.');
        await NewCasePageHelper.verifyTabDisplayed(NewCasePageConstant.leftPanel.notes);
    });

    // Jira References - COTRAC-4107
    it('To verify the buttons and grid available on the Notes page. - [22952476]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 08:48:12 GMT
        StepLogger.caseId = 22952476;

        StepLogger.preCondition('Navigate to notes tab');
        await NewCasePageHelper.navigateToNotesTab(subject);

        StepLogger.stepId(1);
        StepLogger.step('Verify the notes page is displayed.');
        StepLogger.verification('It should be displayed.');
        await NewCasePageHelper.verifyTabDisplayed(NewCasePageConstant.leftPanel.notes);

        StepLogger.stepId(2);
        StepLogger.step('Verify the buttons available on notes page.');
        StepLogger.verification(`It should be have following buttons :
            1. Refresh
            2. Add Note
            3. Select View
            4. Grouping
            5. Export to Excel
            6. Export to Word`);
        await NewCasePageHelper.verifyNotesButtons();

        StepLogger.stepId(3);
        StepLogger.step('Verify the grid available on notes page.');
        StepLogger.verification(`Grid should have following columns:
            1. Note
            2. Related Entity
            3. Delete`);
        await NewCasePageHelper.verifyNotesGrid();
    });

    // Jira References - COTRAC-4102
    it('To verify that user is able to access "New Note" page. - [22952477]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 09:32:40 GMT
        StepLogger.caseId = 22952477;

        StepLogger.preCondition('Navigate to notes tab');
        await NewCasePageHelper.navigateToNotesTab(subject);

        StepLogger.stepId(1);
        StepLogger.step('Verify the add note button is displayed on the top left corner.');
        StepLogger.verification('It should be displayed.');
        await NewCasePageHelper.verifyNotesButtons();

        StepLogger.stepId(2);
        StepLogger.step('Click "Add note"');
        await NewCasePageHelper.clickAddNote();
        StepLogger.verification('"New note" page should be displayed.');
        await NewCasePageHelper.verifyNewNoteDialog();

        StepLogger.stepId(3);
        StepLogger.step('Verify the fields displayed on "New note" page.');
        StepLogger.verification(`It should have following fields:
            1. Subject
            2. Text
            3. Private
            4. Save button
            5. Close button`);
        await NewCasePageHelper.verifyNewNoteDialogFields();
    });

    // Jira References - COTRAC-4108
    it('To verify the functionality of close button on "New note" page. - [22952479]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 10:27:04 GMT
        StepLogger.caseId = 22952479;

        StepLogger.preCondition('Navigate to notes tab');
        await NewCasePageHelper.navigateToNotesTab(subject);

        StepLogger.stepId(1);
        StepLogger.step('Click "Add note"');
        await NewCasePageHelper.clickAddNote(true);
        StepLogger.verification('"New note" page should be displayed.');
        await NewCasePageHelper.verifyNewNoteDialog();

        StepLogger.stepId(2);
        StepLogger.step('Click Close button.');
        await NewCasePageHelper.clickCloseNoteButton();
        StepLogger.verification('Warning message should be displayed.');
        await NewCasePageHelper.verifyWarningDialog();

        StepLogger.stepId(3);
        StepLogger.step('Click "OK"');
        await NewCasePageHelper.clickOkWarningDialog();
        StepLogger.verification('"New note" page should be closed.');
        await NewCasePageHelper.verifyNewNoteDialogClosed();
    });

    // Jira References - COTRAC-4109
    it('To verify that validation error message should be displayed when user clicks save leaving all fields blank. - [22952480]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 10:55:56 GMT
        StepLogger.caseId = 22952480;

        StepLogger.preCondition('Navigate to notes tab');
        await NewCasePageHelper.navigateToNotesTab(subject);

        StepLogger.stepId(1);
        StepLogger.step('Verify the add note button is displayed on the top left corner');
        StepLogger.verification('It should be displayed.');
        await NewCasePageHelper.verifyNotesButtons();

        StepLogger.stepId(2);
        StepLogger.step('Click "Add note"');
        await NewCasePageHelper.clickAddNote();
        StepLogger.verification('"New note" page should be displayed.');
        await NewCasePageHelper.verifyNewNoteDialog();

        StepLogger.stepId(3);
        StepLogger.step('Click "save" leaving all fields blank.');
        await NewCasePageHelper.clickSaveNoteButton();
        StepLogger.verification('Validation Error message should be displayed.');
        await NewCasePageHelper.verifyValidationErrorMessagesNotesDisplayed();
    });

    // Jira References - COTRAC-4110
    it('Verify Validation message when User save New Note without Subject. - [22952497]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 11:11:59 GMT
        StepLogger.caseId = 22952497;

        StepLogger.preCondition('Navigate to notes tab');
        await NewCasePageHelper.navigateToNotesTab(subject);

        StepLogger.stepId(1);
        StepLogger.step('Click "Add note"');
        await NewCasePageHelper.clickAddNote(true);
        StepLogger.verification('"New note" page should be displayed.');
        await NewCasePageHelper.verifyNewNoteDialog();

        StepLogger.stepId(2);
        StepLogger.step('Enter value in text field.');
        await NewCasePageHelper.enterTextNote(note);
        StepLogger.verification('It should be entered.');
        await NewCasePageHelper.verifyTextNote(note);

        StepLogger.stepId(3);
        StepLogger.step('Click "save".');
        await NewCasePageHelper.clickSaveNoteButton(true);
        StepLogger.verification('Validation Error message should be displayed.');
        await NewCasePageHelper.verifyValidationErrorSubjectDisplayed();
    });

    // Jira References - COTRAC-4110
    it('Verify Validation message when User save New Note without Text. - [22952498]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 11:39:07 GMT
        StepLogger.caseId = 22952498;

        StepLogger.preCondition('Navigate to notes tab');
        await NewCasePageHelper.navigateToNotesTab(subject);

        StepLogger.stepId(1);
        StepLogger.step('Click "Add note"');
        await NewCasePageHelper.clickAddNote(true);
        StepLogger.verification('"New note" page should be displayed.');
        await NewCasePageHelper.verifyNewNoteDialog();

        StepLogger.stepId(2);
        StepLogger.step('Enter value in subject field.');
        await NewCasePageHelper.enterSubjectNote(note);
        StepLogger.verification('It should be entered.');
        await NewCasePageHelper.verifySubjectNote(note);

        StepLogger.stepId(3);
        StepLogger.step('Click save.');
        await NewCasePageHelper.clickSaveNoteButton();
        StepLogger.verification('Validation Error message should be displayed.');
        await NewCasePageHelper.verifyValidationErrorTextDisplayed();
    });

    // Jira References - COTRAC-4103
    it('To verify that user can save a non private note. - [22952500]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 12:03:32 GMT
        StepLogger.caseId = 22952500;

        StepLogger.preCondition('Navigate to notes tab');
        await NewCasePageHelper.navigateToNotesTab(subject);

        StepLogger.stepId(1);
        StepLogger.step('Click "Add note"');
        await NewCasePageHelper.clickAddNote(true);
        StepLogger.verification('"New note" page should be displayed.');
        await NewCasePageHelper.verifyNewNoteDialog();

        StepLogger.stepId(2);
        StepLogger.step('Enter value in subject field.');
        await NewCasePageHelper.enterSubjectNote(note);
        StepLogger.verification('It should be entered.');
        await NewCasePageHelper.verifySubjectNote(note);

        StepLogger.stepId(3);
        StepLogger.step('Enter value in text field.');
        await NewCasePageHelper.enterTextNote(note);
        StepLogger.verification('It should be entered.');
        await NewCasePageHelper.verifyTextNote(note);

        StepLogger.stepId(4);
        StepLogger.step('Click "save".');
        await NewCasePageHelper.clickSaveAndCloseNoteButton(true);
        StepLogger.verification('Note should be saved.');
        await NewCasePageHelper.verifyNoteSaved(note);
    });

    // Jira References - COTRAC-4104
    it('To verify that user can save a private note. - [22952501]', async () => {
        // Auto generated by aurea-automation - util on Wed, 03 Apr 2019 12:16:44 GMT
        StepLogger.caseId = 22952501;
        const privateNote = `${NewCasePageConstant.elementNames.test}${PageHelper.getUniqueId()}${PageHelper.getUniqueId()}`;

        StepLogger.preCondition('Navigate to notes tab');
        await NewCasePageHelper.navigateToNotesTab(subject);

        StepLogger.stepId(1);
        StepLogger.step('Click "Add note"');
        await NewCasePageHelper.clickAddNote(true);
        StepLogger.verification('"New note" page should be displayed.');
        await NewCasePageHelper.verifyNewNoteDialog();

        StepLogger.stepId(2);
        StepLogger.step('Enter value in subject field.');
        await NewCasePageHelper.enterSubjectNote(privateNote);
        StepLogger.verification('It should be entered.');
        await NewCasePageHelper.verifySubjectNote(privateNote);

        StepLogger.stepId(3);
        StepLogger.step('Enter value in text field.');
        await NewCasePageHelper.enterTextNote(privateNote);
        StepLogger.verification('It should be entered.');
        await NewCasePageHelper.verifyTextNote(privateNote);

        StepLogger.stepId(4);
        StepLogger.step('Select "yes" in "Private" option.');
        await NewCasePageHelper.selectPrivateNote(true);
        StepLogger.verification('It should be selected.');
        await NewCasePageHelper.verifyPrivateNoteOn();

        StepLogger.stepId(5);
        StepLogger.step('Click "save".');
        await NewCasePageHelper.clickSaveAndCloseNoteButton(true);
        StepLogger.verification('A private note should be displayed.');
        await NewCasePageHelper.verifyNoteSaved(privateNote);
    });
});
