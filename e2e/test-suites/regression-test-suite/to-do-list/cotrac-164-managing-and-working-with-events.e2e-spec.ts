import { StepLogger } from '../../../../core/logger/step-logger';
import { PageHelper } from '../../../components/html/page-helper';
import { HomePageHelper } from '../../../page-objects/pages/home-page/home-page.helper';
import { LoginPageHelper } from '../../../page-objects/pages/login-page/login-page.helper';
import { ToDoListPageHelper } from '../../../page-objects/pages/to-do-list/to-do-list-page.helper';
import { ToDoListPageConstant } from '../../../page-objects/pages/to-do-list/to-do-list.constants';

import { SuiteNames } from '../../helpers/suite-names';

describe(SuiteNames.regressionSuite, () => {
    const overdue = ToDoListPageConstant.overdue;
    let loginPageHelper: LoginPageHelper;
    let subjectName = PageHelper.getUniqueId();

    beforeAll(async () => {
        loginPageHelper = LoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
    });

    beforeEach(async () => {
        await PageHelper.restartBrowser();
        await loginPageHelper.goTo();
        await LoginPageHelper.loginAsAdmin();
        await HomePageHelper.clickToDoListLabel();
    });

    // Jira References - COTRAC-164
    it('To verify that user is able to access "To Do List" page. - [22960370]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT

        StepLogger.caseId = 22960370;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List" label');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify the elements displayed on to do list page.');
        StepLogger.verification(`The following elements should be present :
            1. My activities filter.
            2. Filter based on status of completion of tasks
            3. Search text box
            4. Refresh`);
        await ToDoListPageHelper.verifyPageElementsDisplayed();
    });

    // Jira References - COTRAC-164
    it('To verify that user can filter tasks "due today". - [22960371]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 17:06:06 GMT

        StepLogger.caseId = 22960371;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List"');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('User should be able to select "Due today" in the filter');
        await ToDoListPageHelper.clickOnOverdueArrow();
        StepLogger.verification('Tasks due today should be displayed.');
        await ToDoListPageHelper.verifyDisplayedItemInDdl(overdue.dueToday);
    });

    // Jira References - COTRAC-164
    it('To verify that user can filter tasks "due tomorrow". - [22960372]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:40:59 GMT

        StepLogger.caseId = 22960372;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List"');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('User should be able to select "Due tomorrow" in the filter');
        await ToDoListPageHelper.clickOnOverdueArrow();
        StepLogger.verification('Tasks due tomorrow should be displayed.');
        await ToDoListPageHelper.verifyDisplayedItemInDdl(overdue.dueTomorrow);
    });

    // Jira References - COTRAC-164
    it('To verify that user can filter tasks "due this week". - [22960373]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:40:59 GMT

        StepLogger.caseId = 22960373;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List"');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('User should be able to select "Due this week" in the filter');
        await ToDoListPageHelper.clickOnOverdueArrow();
        StepLogger.verification('Tasks due this week should be displayed.');
        await ToDoListPageHelper.verifyDisplayedItemInDdl(overdue.dueThisWeek);
    });

    // Jira References - COTRAC-164
    it('To verify that user can filter tasks "Overdue". - [22960374]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:40:59 GMT

        StepLogger.caseId = 22960374;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List"');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('User should be able to select "Overdue" in the filter');
        await ToDoListPageHelper.clickOnOverdueArrow();
        StepLogger.verification('Tasks Overdue should be displayed.');
        await ToDoListPageHelper.verifyDisplayedItemInDdl(overdue.overdue);
    });

    // Jira References - COTRAC-164
    it('To verify that user can filter tasks "due next week". - [22960375]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT

        StepLogger.caseId = 22960375;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List"');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('User should be able to select "Due next week" in the filter');
        await ToDoListPageHelper.clickOnOverdueArrow();
        StepLogger.verification('Tasks Due next week should be displayed.');
        await ToDoListPageHelper.verifyDisplayedItemInDdl(overdue.dueNextWeek);
    });

    // Jira References - COTRAC-164
    it('To verify that user can filter tasks "due this month". - [22960376]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT

        StepLogger.caseId = 22960376;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List"');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('User should be able to select "Due this month" in the filter');
        await ToDoListPageHelper.clickOnOverdueArrow();
        StepLogger.verification('Tasks Due this month should be displayed.');
        await ToDoListPageHelper.verifyDisplayedItemInDdl(overdue.dueThisMonth);
    });

    // Jira References - COTRAC-164
    it('To verify that user can filter tasks "Completed today". - [22960377]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT

        StepLogger.caseId = 22960377;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List"');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('User should be able to select "Completed today" in the filter.');
        await ToDoListPageHelper.clickOnOverdueArrow();
        StepLogger.verification('Tasks Completed today should be displayed.');
        await ToDoListPageHelper.verifyDisplayedItemInDdl(overdue.completedToday);
    });

    // Jira References - COTRAC-164
    it('To verify that user can filter tasks "Completed this week". - [22960378]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT

        StepLogger.caseId = 22960378;
        StepLogger.stepId(1);
        StepLogger.step('Verify that To do list menu item is displayed in the left panel.');
        StepLogger.verification('To do List should be displayed.');
        await HomePageHelper.verifyToDoListLinkDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "To do List"');
        await HomePageHelper.clickToDoListLabel();
        StepLogger.verification('To Do list page should be displayed.');
        await ToDoListPageHelper.verifyToDoListPageIsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('User should be able to select "Completed this week" in the filter');
        await ToDoListPageHelper.clickOnOverdueArrow();
        StepLogger.verification('Completed this week today should be displayed.');
        await ToDoListPageHelper.verifyDisplayedItemInDdl(overdue.dueThisWeek);
    });

    // Jira References - COTRAC-164
    it('To verify that user is able to open Event tab of a contact. - [22960379]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT
        const events = ToDoListPageConstant.contactTabs.events;

        StepLogger.caseId = 22960379;
        StepLogger.stepId(1);
        StepLogger.step('Search for a contact in global search box.');
        await ToDoListPageHelper.searchForContact();
        StepLogger.verification('All the matching results should be displayed.');
        await ToDoListPageHelper.verifyContactElementDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Select the contact');
        await ToDoListPageHelper.clickContactElement();
        await ToDoListPageHelper.clickCloseIconInSnapshot();
        StepLogger.verification('Contact details should be displayed.');
        await ToDoListPageHelper.verifyContactPageDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Goto Events tab');
        await ToDoListPageHelper.clickTab(ToDoListPageConstant.contactTabs.events);
        StepLogger.verification('Events tab should be displayed.');
        await ToDoListPageHelper.verifyTabDisplayed(events);
    });

    // Jira References - COTRAC-164
    it('To verify that created Event is getting displayed in to do list page. - [22960380]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT
        const events = ToDoListPageConstant.contactTabs.events;

        StepLogger.preCondition(`Go to contact and select "${events}" tab`);
        await ToDoListPageHelper.goToContactAndSelectTab(events);

        StepLogger.caseId = 22960380;
        StepLogger.stepId(1);
        StepLogger.step('Click "Add event" icon');
        await ToDoListPageHelper.clickAddEventIcon();
        StepLogger.verification('New Event dialog box should be displayed.');
        await ToDoListPageHelper.verifyCreatedActivity(ToDoListPageConstant.elementNames.newEvent);

        StepLogger.stepId(2);
        StepLogger.step('Enter values in mandatory fields.');
        StepLogger.verification('It should be entered.');
        await ToDoListPageHelper.verifyCanTypeInSubjectTextbox(subjectName, true);

        StepLogger.stepId(3);
        StepLogger.step('Click "save" icon.');
        await ToDoListPageHelper.clickSaveActivity(false);
        StepLogger.verification('Event should be saved.');
        await ToDoListPageHelper.verifyCreatedActivity(subjectName);

        StepLogger.stepId(4);
        StepLogger.step('Go to Todo list page.');
        await ToDoListPageHelper.switchTabAndGetOverdueList();
        await ToDoListPageHelper.typeInSearchBox(subjectName);
        StepLogger.verification('The Event created in step 3 should be displayed under due today filter.');
        await ToDoListPageHelper.verifySubjectNameInActivityListDisplayed(subjectName);
    });

    // Jira References - COTRAC-164
    it('To verify that the user can edit the Event from to do page. - [22960381]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT

        StepLogger.preCondition('Get data based on overdue');
        await ToDoListPageHelper.getOverdueData(subjectName);

        StepLogger.caseId = 22960381;
        StepLogger.stepId(1);
        StepLogger.step('Verify that Edit button is displayed beside the event in To Do list page.');
        StepLogger.verification('Edit button should be displayed.');
        await ToDoListPageHelper.verifyEditButtonDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "Edit" icon');
        await ToDoListPageHelper.clickEditButton();
        StepLogger.verification('Edit Event dialog box should be displayed.');
        await ToDoListPageHelper.verifyEditPanelDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Edit the subject.');
        StepLogger.verification('User should be able to edit the subject.');
        subjectName = await ToDoListPageHelper.verifyCanEditSubjectTb();

        StepLogger.stepId(4);
        StepLogger.step('Edit start date and End date');
        StepLogger.verification('User should be able to edit the start dates and the end dates.');
        await ToDoListPageHelper.verifyCanEditStartAndEndDateAndTime();

        StepLogger.stepId(5);
        StepLogger.step(`Click "save". and refresh the to do list.
            Select the filter as per the dates selected in step 4.`);
        await ToDoListPageHelper.clickSaveEditEventLink();
        StepLogger.verification('Edited task should be displayed in the list.');
        await ToDoListPageHelper.verifySubjectNameInActivityListDisplayed(subjectName);
    });

    // Jira References - COTRAC-164
    it('To verify that user can mark the task completed. - [22960382]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT

        StepLogger.preCondition('Get due this week data');
        const newSubject = await ToDoListPageHelper.createNewActivityAndGetInToDoListTable(
            ToDoListPageConstant.contactTabs.events);

        StepLogger.caseId = 22960382;
        StepLogger.stepId(1);
        StepLogger.step('Verify that tick mark button is displayed beside the task in To Do list page.');
        StepLogger.verification('It should be displayed.');
        await ToDoListPageHelper.verifyOccurredTickDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "Mark as complete" tick mark.');
        await ToDoListPageHelper.getOverdueData(newSubject);
        StepLogger.verification('The Event should be marked as complete.');
        await ToDoListPageHelper.verifyCanClickOccurredTick();

        StepLogger.stepId(3);
        StepLogger.step('Select Completed today in the filter and Refresh the list');
        StepLogger.verification('The Event completed in step 2 should be listed there.');
        await ToDoListPageHelper.getCompletedData(newSubject);
        await ToDoListPageHelper.verifySubjectNameInActivityListDisplayed(newSubject);
    });

    // Jira References - COTRAC-164
    it('To verify that user can mark the task completed by Edit Task. - [22960383]', async () => {
        // Auto generated by aurea-automation - util on Tue, 19 Mar 2019 16:41:00 GMT

        StepLogger.preCondition('Get data based on overdue');
        const newSubject = await ToDoListPageHelper.createNewActivityAndGetInToDoListTable(
            ToDoListPageConstant.contactTabs.events);

        StepLogger.caseId = 22960383;
        StepLogger.stepId(1);
        StepLogger.step('Verify that Edit button is displayed beside the event in To Do list page.');
        StepLogger.verification('Edit button should be displayed.');
        await ToDoListPageHelper.verifyEditButtonDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click "Edit" icon');
        await ToDoListPageHelper.clickEditButton();
        StepLogger.verification('Edit task dialog box should be displayed.');
        await ToDoListPageHelper.verifyEditPanelDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Check the "Occurred" checkbox. ');
        StepLogger.verification('It should be checked.');
        await ToDoListPageHelper.verifyCanCheckOccuredInEditPanel();

        StepLogger.stepId(4);
        StepLogger.step('Select any "Deposition"');
        StepLogger.verification('It should be selected.');
        await ToDoListPageHelper.verifyCanSelectElementsDepositionFromDdl();

        StepLogger.stepId(5);
        StepLogger.step('Click "save".');
        await ToDoListPageHelper.clickSaveEditEventLink();
        StepLogger.verification('Task should be completed.');
        await ToDoListPageHelper.verifyEditPanelHidden();

        StepLogger.stepId(6);
        StepLogger.step('Select Completed today in the filter and Refresh the list');
        await ToDoListPageHelper.getCompletedData(newSubject);
        StepLogger.verification('The task completed in step 4 should be listed there.');
        await ToDoListPageHelper.verifySubjectNameInActivityListDisplayed(newSubject);
    });
});
