import { StepLogger } from '../../../../../core/logger/step-logger';
import { PageHelper } from '../../../../components/html/page-helper';
import { WaitHelper } from '../../../../components/html/wait-helper';
import { Constants } from '../../../../components/misc-utils/constants';
import { HomePage1Helper } from '../../../../page-objects/pages/home-page/home-page1.helper';
import { LoginPageHelper } from '../../../../page-objects/pages/login-page/login-page.helper';
import { CampaignsConstant } from '../../../../page-objects/pages/marketing/campaigns/campaigns.constants';
import { CampaignsPageHelper } from '../../../../page-objects/pages/marketing/campaigns/campaigns.helper';
import { SuiteNames } from '../../../helpers/suite-names';

describe(SuiteNames.regressionSuite, () => {
    let loginPageHelper: LoginPageHelper;

    beforeAll(async () => {
        loginPageHelper = LoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
    });

    beforeEach(async () => {
        await PageHelper.restartBrowser();
        await loginPageHelper.goTo();
        await LoginPageHelper.loginAsAdmin();
    });

    // Jira References - COTRAC-5184
    it('Verify user is able to and navigate to Campaign detail page. - [22959118]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959118;
        StepLogger.preCondition('Navigate to Marketing Campaigns page');
        await HomePage1Helper.navigateToMarketingCampaignsPage();

        StepLogger.stepId(1);
        StepLogger.step('Verify grouping drop down is appearing on the right side of the page');
        StepLogger.verification('Grouping drop down should be appearing on the left side of the page.');
        await CampaignsPageHelper.verifyGroupingFieldDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Verify user columns appearing on the page.');
        StepLogger.verification(`Following columns should be appearing on the page:
        - Campaign
        - Type
        - Owner
        - Active
        - Created.`);
        await CampaignsPageHelper.verifyCampaignsGridColumns();

        StepLogger.stepId(3);
        StepLogger.step('Verify campaign logo is appearing on the table on the first column.');
        StepLogger.verification('campaign logo should be appearing on the table on the first column.');
        await CampaignsPageHelper.verifyAddCampaignButtonDislayed();

        StepLogger.stepId(4);
        StepLogger.step('Verify user clicks on the campaign logo.');
        await CampaignsPageHelper.clickOnTheFirstCampaignIcon();
        StepLogger.verification('Campaign page should open successfully.');
        await CampaignsPageHelper.verifyCampaignPageDisplayed(false);

        StepLogger.stepId(5);
        StepLogger.step('Verify tabs appearing on the left side of the page.');
        StepLogger.verification(`Following menu tabs should be appearing on left side of the page:
        - Overview
        - Distribution
        - Campaign Items
        - Notes
        - Attachments
        - Campaign Stats`);
        await CampaignsPageHelper.verifyCampaignPageTabs();
    });

    // Jira References - COTRAC-5192
    it('Verify user should not be  able to set Description field as null. - [22960283]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:45 GMT

        StepLogger.caseId = 22960283;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify Description field is appearing on the Overview tab.');
        StepLogger.verification('Description  field should be appearing on the Overview tab.');
        await CampaignsPageHelper.verifyDescriptionFieldDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Set Description field as empty.');
        const description = Constants.EMPTY_STRING;
        await CampaignsPageHelper.typeDescription(description);
        StepLogger.verification('Description field should be empty.');
        await CampaignsPageHelper.verifyDescriptionFieldIsEmpty();

        StepLogger.stepId(3);
        StepLogger.step('Click on the Save button');
        await CampaignsPageHelper.clickOnSaveButton();
        StepLogger.verification('Error message should appear "DESCRIPTION is required."');
        await CampaignsPageHelper.verifyValidationMessageDisplayed(CampaignsConstant.messages.descriptionRequired);
    });

    // Jira References - COTRAC-5203
    it('Verify user clicks on Close button and verify user clicks on OK button on Warning pop up. - [22959142]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:45 GMT

        StepLogger.caseId = 22959142;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify NAME1 field is appearing on the Overview tab.');
        StepLogger.verification('NAME1 field should be appearing on the Overview tab.');
        await CampaignsPageHelper.verifyName1FieldDisplay();

        StepLogger.stepId(2);
        StepLogger.step('Click on the "cross icon"');
        await CampaignsPageHelper.clickOnCloseButton();
        StepLogger.verification('Warning pop up should open, "Are you sure you want to leave this page? Unsaved changes will be lost."');
        await CampaignsPageHelper.verifyWarningPopupDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify buttons on the Warning pop up');
        StepLogger.verification(`Following buttons should appear on the warning pop up:
        - OK
        - CAncel`);
        await CampaignsPageHelper.verifyWarningPopupButtons();

        StepLogger.stepId(4);
        StepLogger.step('Click on the OK button on the warning pop up.');
        await CampaignsPageHelper.clickOkButtonOnWarningPopup();
        StepLogger.verification('user should navigate back to Marketing Campaign page.');
        await CampaignsPageHelper.verifyWarningPopupClosed();
    });

    // Jira References - COTRAC-5191
    it('Verify user should not be  able to set Name1 field as null. - [22960282]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:46 GMT

        StepLogger.caseId = 22960282;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify NAME1 field is appearing on the Overview tab.');
        StepLogger.verification('NAME1 field should be appearing on the Overview tab.');
        await CampaignsPageHelper.verifyName1FieldDisplay();

        StepLogger.stepId(2);
        StepLogger.step('Set Name1 to empty.');
        const name = Constants.EMPTY_STRING;
        await CampaignsPageHelper.typeName(name);
        StepLogger.verification('Name1 should be empty.');
        await CampaignsPageHelper.verifyNameOneFieldIsEmpty();

        StepLogger.stepId(3);
        StepLogger.step('Click on Save button');
        await CampaignsPageHelper.clickOnSaveButton();
        StepLogger.verification('Error message should appear "NAME1 is required."');
        await CampaignsPageHelper.verifyValidationMessageDisplayed(CampaignsConstant.messages.nameRequired);
    });

    // Jira References - COTRAC-5202
    it('Verify user clicks on Close button and verify user clicks on Cancel button on Warning pop up. - [22959141]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:46 GMT

        StepLogger.caseId = 22959141;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify NAME1 field is appearing on the Overview tab.');
        StepLogger.verification('NAME1 field should be appearing on the Overview tab.');
        await CampaignsPageHelper.verifyName1FieldDisplay();

        StepLogger.stepId(2);
        StepLogger.step('Click on the "cross icon"');
        await CampaignsPageHelper.clickOnCloseButton();
        StepLogger.verification('Warning pop up should open, "Are you sure you want to leave this page? Unsaved changes will be lost."');
        await CampaignsPageHelper.verifyWarningPopupDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify buttons on the Warning pop up');
        StepLogger.verification(`Following buttons should appear on the warning pop up:
        - OK
        - CAncel`);
        await CampaignsPageHelper.verifyWarningPopupButtons();

        StepLogger.stepId(4);
        StepLogger.step('Click on Cancel button.');
        await CampaignsPageHelper.clickCancelButtonOnWarningPopup();
        StepLogger.verification('Warning pop up should close and user should stay on the campaign page.');
        await CampaignsPageHelper.verifyWarningPopupClosed();
        await CampaignsPageHelper.verifyCampaignPageDisplayed();
    });

    // Jira References - COTRAC-5185
    it('Verify user is able to update Name1. - [22959121]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959121;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify NAME1 field is appearing on the Overview tab.');
        StepLogger.verification('NAME1 field should be appearing on the Overview tab.');
        await CampaignsPageHelper.verifyName1FieldDisplay();

        StepLogger.stepId(2);
        StepLogger.step('Update the value of Name1 field.');
        const name = PageHelper.getUniqueId();
        await CampaignsPageHelper.typeName(name);
        StepLogger.verification('Name1 field should be updated.');
        await CampaignsPageHelper.verifyNameOneFieldValue(name);

        StepLogger.stepId(3);
        StepLogger.step('Click on the Save button appearing on the top right side of the page.');
        await CampaignsPageHelper.clickOnSaveButton();
        StepLogger.verification('campaign name should be updated and updated name should be appearing on the top of the page.');
        await CampaignsPageHelper.verifyNewCampaignHasBeenSaved(true, name);
    });

    // Jira References - COTRAC-5187
    it('Verify user is able to open History. - [22959129]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959129;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify three dots are appearing on the top left side of the page.');
        StepLogger.verification('three  vertical dots icon should be appearing on the top left side of the page.');
        await CampaignsPageHelper.verifyThreeVerticalDotsAreDisplayedOnCampaignData();

        StepLogger.stepId(2);
        StepLogger.step('Verify user clicks on the three vertical dots.');
        await CampaignsPageHelper.clickThreeDotsIconOnCampaignData();
        StepLogger.verification('Drop down menu should expand');
        await CampaignsPageHelper.verifyThreeDotsFloatingMenuDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify "History" is appearing under Drop down menu');
        StepLogger.verification('"History" should be  appearing under Drop down menu');
        await CampaignsPageHelper.verifyHistoryOptionFromTheDropdown();

        StepLogger.stepId(4);
        StepLogger.step('Click on "History" link');
        await CampaignsPageHelper.clickOnHistoryOptionFromTheDropdown();
        StepLogger.verification('History pop up should open. Heading of pop up should be "History"');
        await CampaignsPageHelper.verifyHistoryModalIsDisplayed();
    });

    // Jira References - COTRAC-5201
    it('Verify user clicks on Close button and verify Warning pop up. - [22959140]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959140;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify NAME1 field is appearing on the Overview tab.');
        StepLogger.verification('NAME1 field should be appearing on the Overview tab.');
        await CampaignsPageHelper.verifyName1FieldDisplay();

        StepLogger.stepId(2);
        StepLogger.step('Click on the "cross icon"');
        await CampaignsPageHelper.clickOnCloseButton();
        StepLogger.verification('Warning pop up should open, "Are you sure you want to leave this page? Unsaved changes will be lost."');
        await CampaignsPageHelper.verifyWarningPopupDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify buttons on the Warning pop up');
        StepLogger.verification(`Following buttons should appear on the warning pop up:
        - OK
        - CAncel`);
        await CampaignsPageHelper.verifyWarningPopupButtons();
    });

    // Jira References - COTRAC-5195
    it('Verify user is not able to update Type. - [22959123]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959123;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify "Type" field is appearing on the Overview tab.');
        StepLogger.verification('"Type"  field should be appearing on the Overview tab.');
        await CampaignsPageHelper.verifyTypeFieldDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Verify user  is not able to update the value in the "Type" field.');
        StepLogger.verification('user  should  not able to update the value in the "Type" field.');
        await CampaignsPageHelper.verifyTypeFieldIsReadOnly();

        StepLogger.stepId(3);
        StepLogger.step('Verify user clicks on the close button.');
        await CampaignsPageHelper.clickOnCloseButton();
        StepLogger.verification('Warning pop will appear with message "Are you sure you want to leave this page? Unsaved changes will be lost"');
        await CampaignsPageHelper.verifyWarningPopupDisplayed();

        StepLogger.stepId(4);
        StepLogger.step('Click on cancel button on the warning pop up');
        await CampaignsPageHelper.clickCancelButtonOnWarningPopup();
        StepLogger.verification('user should navigate back to "Marketing Campaigns"" page.');
        await CampaignsPageHelper.verifyCampaignPageDisplayed();
    });

    // Jira References - COTRAC-5200
    it('Verify user clicks on Cancel button on confirmation box. - [22959137]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959137;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify three dots are appearing on the top left side of the page.');
        StepLogger.verification('three  vertical dots icon should be appearing on the top left side of the page.');
        await CampaignsPageHelper.verifyThreeVerticalDotsAreDisplayedOnCampaignData();

        StepLogger.stepId(2);
        StepLogger.step('Verify user clicks on the three vertical dots.');
        await CampaignsPageHelper.clickThreeDotsIconOnCampaignData();
        StepLogger.verification('Drop down menu should expand');
        await CampaignsPageHelper.verifyThreeDotsFloatingMenuDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify "Delete (including distributed items" is appearing under Drop down menu');
        StepLogger.verification(`"Delete (including distributed items" should be appearing under Drop down
        menu`);
        await CampaignsPageHelper.verifyDeleteOptionFromTheDropdown();

        StepLogger.stepId(4);
        StepLogger.step('Click on  "Delete (including distributed items" link');
        await CampaignsPageHelper.clickOnDeleteOptionFromTheDropdown();
        StepLogger.verification(`Delete confirmation pop up should appear "Are you sure you
        want to delete this campaign and all pipelines and events that it has distributed?"`);
        await CampaignsPageHelper.verifyDeleteConfirmationPopupDisplayed();

        StepLogger.stepId(5);
        StepLogger.step('Click on the Cancel button on the Confirmation box.');
        await CampaignsPageHelper.clickCancelButtonOnDeleteConfirmationPopup();
        StepLogger.verification('Confirmation box should close. Record should not delete.');
        await CampaignsPageHelper.verifyDeleteConfirmationPopupClosed();
    });

    // Jira References - COTRAC-5188
    it('Verify user is able to delete campaign. - [22959138]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959138;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        const name = await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify three dots are appearing on the top left side of the page.');
        StepLogger.verification('three  vertical dots icon should be appearing on the top left side of the page.');
        await CampaignsPageHelper.verifyThreeVerticalDotsAreDisplayedOnCampaignData();

        StepLogger.stepId(2);
        StepLogger.step('Verify user clicks on the three vertical dots.');
        await CampaignsPageHelper.clickThreeDotsIconOnCampaignData();
        StepLogger.verification('Drop down menu should expand');
        await CampaignsPageHelper.verifyThreeDotsFloatingMenuDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify "Delete (including distributed items" is appearing under Drop down menu');
        StepLogger.verification(`"Delete (including distributed items" should be appearing under Drop down
        menu`);
        await CampaignsPageHelper.verifyDeleteOptionFromTheDropdown();

        StepLogger.stepId(4);
        StepLogger.step('Click on  "Delete (including distributed items" link');
        await CampaignsPageHelper.clickOnDeleteOptionFromTheDropdown();
        StepLogger.verification(`Delete confirmation pop up should appear "Are you sure you want to
        delete this campaign and all pipelines and events that it has distributed?"`);
        await CampaignsPageHelper.verifyDeleteConfirmationPopupDisplayed();

        StepLogger.stepId(5);
        StepLogger.step('Click on the Close Delete button on the confirmation pop up');
        await CampaignsPageHelper.clikOnCloseButtonFromMessagePopup();
        StepLogger.verification('user should navigate back to Marketing campaign page.');
        await CampaignsPageHelper.verifyCampaignPageDisplayed();

        StepLogger.stepId(6);
        StepLogger.step('Click on the refresh button present on the top of the page.');
        await CampaignsPageHelper.clickOnRefreshButton();
        StepLogger.verification('Data in the table should refresh and deleted record should not present in the Marketing campaign table now.');
        await CampaignsPageHelper.verifyCampaignNotDisplayed(name);
    });

    // Jira References -  COTRAC-5186
    it('Verify user is able to update Description. - [22959122]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959122;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify Description field is appearing on the Overview tab.');
        StepLogger.verification('Description field should be appearing on the Overview tab.');
        await CampaignsPageHelper.verifyDescriptionFieldDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Update the value of Description field.');
        const description = PageHelper.getUniqueId();
        await CampaignsPageHelper.typeDescription(description);
        StepLogger.verification('Description should be updated.');
        await CampaignsPageHelper.verifyDescriptionFieldValue(description);

        StepLogger.stepId(3);
        StepLogger.step('Click on the Save button appearing on the right side of the page.');
        await CampaignsPageHelper.clickOnSaveButton();
        StepLogger.verification('Update should be saved');
        await WaitHelper.waitForPageToStable();
        await CampaignsPageHelper.verifyDescriptionFieldValue(description);

        StepLogger.stepId(4);
        StepLogger.step('Click on Close button present on the right side of the page.');
        await CampaignsPageHelper.clickOnCloseButton();
        StepLogger.verification('Warning pop will appear with message "Are you sure you want to leave this page? Unsaved changes will be lost"');
        await CampaignsPageHelper.verifyWarningPopupDisplayed();

        StepLogger.stepId(5);
        StepLogger.step('Click on cancel button on the warning pop up');
        await CampaignsPageHelper.clickCancelButtonOnWarningPopup();
        StepLogger.verification('user should navigate back to "Marketing Campaigns"" page.');
        await CampaignsPageHelper.verifyCampaignPageDisplayed();

        StepLogger.stepId(6);
        StepLogger.step('Click on the campaign logo again to navigate to Campaign page.');
        await CampaignsPageHelper.openACampaign();
        StepLogger.verification('Update description should be appearing in the Description field.');
        await CampaignsPageHelper.verifyDescriptionFieldValue(description);
    });

    // Jira References - COTRAC-5199
    it('Verify user clicks on Delete button and verify confirmation box. - [22959135]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 19:02:47 GMT

        StepLogger.caseId = 22959135;
        StepLogger.preCondition('Navigate to Campaigns page and open an existing campaign');
        await HomePage1Helper.navigateToMarketingCampaignsPage();
        await CampaignsPageHelper.openACampaign();

        StepLogger.stepId(1);
        StepLogger.step('Verify three dots are appearing on the top left side of the page.');
        StepLogger.verification('three  vertical dots icon should be appearing on the top left side of the page.');
        await CampaignsPageHelper.verifyThreeVerticalDotsAreDisplayedOnCampaignData();

        StepLogger.stepId(2);
        StepLogger.step('Verify user clicks on the three vertical dots.');
        await CampaignsPageHelper.clickThreeDotsIconOnCampaignData();
        StepLogger.verification('Drop down menu should expand');
        await CampaignsPageHelper.verifyThreeDotsFloatingMenuDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify "Delete (including distributed items" is appearing under Drop down menu');
        StepLogger.verification(`"Delete (including distributed items" should be appearing under Drop down
        menu`);
        await CampaignsPageHelper.verifyDeleteOptionFromTheDropdown();

        StepLogger.stepId(4);
        StepLogger.step('Click on  "Delete (including distributed items" link');
        await CampaignsPageHelper.clickOnDeleteOptionFromTheDropdown();
        StepLogger.verification(`Delete confirmation pop up should appear "Are you sure you
        want to delete this campaign and all pipelines and events that it has distributed?"`);
        await CampaignsPageHelper.verifyDeleteConfirmationPopupDisplayed();
    });
});
