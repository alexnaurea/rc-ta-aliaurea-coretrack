import { StepLogger } from '../../../../../core/logger/step-logger';
import { PageHelper } from '../../../../components/html/page-helper';
import { Constants } from '../../../../components/misc-utils/constants';
import { HomePage1Helper } from '../../../../page-objects/pages/home-page/home-page1.helper';
import { LoginPageHelper } from '../../../../page-objects/pages/login-page/login-page.helper';
import { CampaignsConstant } from '../../../../page-objects/pages/marketing/campaigns/campaigns.constants';
import { CampaignsPageHelper } from '../../../../page-objects/pages/marketing/campaigns/campaigns.helper';
import { SuiteNames } from '../../../helpers/suite-names';

describe(SuiteNames.regressionSuite, () => {
    let loginPageHelper: LoginPageHelper;

    beforeAll(async () => {
        loginPageHelper = LoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
    });

    beforeEach(async () => {
        await PageHelper.restartBrowser();
        await loginPageHelper.goTo();
        await LoginPageHelper.loginAsAdmin();
    });

    // Jira References - COTRAC-4596
    it('Verify if user shall be able to sort the grid list by Created column - [22416729]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 14:13:49 GMT

        StepLogger.caseId = 22416729;
        StepLogger.stepId(1);
        StepLogger.step('Click on Marketing button menu.');
        await HomePage1Helper.clickOnMarketingMenu();
        StepLogger.verification(`Should expand and the menu and should the options:
        -Marketing List
        -Campaigns`);
        await HomePage1Helper.verifyMarketingSubmenu();

        StepLogger.stepId(2);
        StepLogger.step('Click on Campaigns button.');
        await HomePage1Helper.clickOnCampaignsOption();
        StepLogger.verification('Should display the Marketing Campaigns screen properly.');
        await CampaignsPageHelper.verifyMarketingCampaignsPageDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on Created column.');
        await CampaignsPageHelper.clickOnCreatedColumn();
        StepLogger.verification('Should sort the grid data by Created column properly.');
        await CampaignsPageHelper.verifyRecordsSortedAsc(CampaignsConstant.elementNames.marketingColumns.created);
    });

    // Jira References - COTRAC-4581
    it('Verify if user shall be able to filter the grid list by No Grouping option - [22416683]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 14:13:49 GMT

        StepLogger.caseId = 22416683;
        StepLogger.stepId(1);
        StepLogger.step('Click on Marketing button menu.');
        await HomePage1Helper.clickOnMarketingMenu();
        StepLogger.verification(`Should expand and the menu and should the options:
        -Marketing List
        -Campaigns`);
        await HomePage1Helper.verifyMarketingSubmenu();

        StepLogger.stepId(2);
        StepLogger.step('Click on Campaigns button.');
        await HomePage1Helper.clickOnCampaignsOption();
        StepLogger.verification('Should display the Marketing Campaigns screen properly.');
        await CampaignsPageHelper.verifyMarketingCampaignsPageDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Select the "No Grouping" option in the filter.');
        await CampaignsPageHelper.selectGroupingOption(CampaignsConstant.groupingOptions.noGrouping);
        StepLogger.verification('Should display campaigns type as "No Grouping" in the grid classified in sections.');
        await CampaignsPageHelper.verifyRecordsUngrouped();
    });

    // Jira References - COTRAC-4594
    it('Verify if user shall be able to sort the grid list by Owner column - [22416727]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 14:13:49 GMT

        StepLogger.caseId = 22416727;
        StepLogger.stepId(1);
        StepLogger.step('Click on Marketing button menu.');
        await HomePage1Helper.clickOnMarketingMenu();
        StepLogger.verification(`Should expand and the menu and should the options:
        -Marketing List
        -Campaigns`);
        await HomePage1Helper.verifyMarketingSubmenu();

        StepLogger.stepId(2);
        StepLogger.step('Click on Campaigns button.');
        await HomePage1Helper.clickOnCampaignsOption();
        StepLogger.verification('Should display the Marketing Campaigns screen properly.');
        await CampaignsPageHelper.verifyMarketingCampaignsPageDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on Owner column.');
        await CampaignsPageHelper.clickOnOwnerColumn();
        StepLogger.verification('Should sort the grid data by Owner column properly.');
        await CampaignsPageHelper.verifyRecordsSortedAsc(CampaignsConstant.elementNames.marketingColumns.owner);
    });

    // Jira References - COTRAC-4591
    it('Verify if user shall be able to close the create action clicking on Close button - [22416723]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 14:13:49 GMT

        StepLogger.caseId = 22416723;
        StepLogger.stepId(1);
        StepLogger.step('Click on Marketing button menu.');
        await HomePage1Helper.clickOnMarketingMenu();
        StepLogger.verification(`Should expand and the menu and should the options:
        -Marketing List
        -Campaigns`);
        await HomePage1Helper.verifyMarketingSubmenu();

        StepLogger.stepId(2);
        StepLogger.step('Click on Campaigns button.');
        await HomePage1Helper.clickOnCampaignsOption();
        StepLogger.verification('Should display the Marketing Campaigns screen properly.');
        await CampaignsPageHelper.verifyMarketingCampaignsPageDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on Create New Campaign button.');
        await CampaignsPageHelper.clickOnAddCampaignButton();
        StepLogger.verification('Should open the Create New Marketing Campaign screen properly.');
        await CampaignsPageHelper.verifyNewCampaignPageDisplayed(false);

        StepLogger.stepId(4);
        StepLogger.step('Fill all mandatory fields and click on Close button.');
        await CampaignsPageHelper.fillInNewCampaignMandatoryFields();
        await CampaignsPageHelper.clickOnCloseButton();
        StepLogger.verification('Should display the popup confirmation properly.');
        await CampaignsPageHelper.verifyWarningPopupDisplayed();

        StepLogger.stepId(5);
        StepLogger.step('Click on "OK" button.');
        await CampaignsPageHelper.clickOkButtonOnWarningPopup();
        StepLogger.verification('Should close the tab and display the main Marketing Campaign screen properly.');
        await CampaignsPageHelper.verifyWarningPopupClosed();
    });

    // Jira References - COTRAC-4576
    it('Verify if Marketing Campaigns screen is displaying properly - [22416676]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 14:13:50 GMT

        StepLogger.caseId = 22416676;
        StepLogger.stepId(1);
        StepLogger.step('Click on Marketing button menu.');
        await HomePage1Helper.clickOnMarketingMenu();
        StepLogger.verification(`Should expand and the menu and should the options:
        -Marketing List
        -Campaigns`);
        await HomePage1Helper.verifyMarketingSubmenu();

        StepLogger.stepId(2);
        StepLogger.step('Click on Campaigns button.');
        await HomePage1Helper.clickOnCampaignsOption();
        StepLogger.verification('Should display the Marketing Campaigns screen properly.');
        await CampaignsPageHelper.verifyMarketingCampaignsPageDisplayed();

        // Step 3 is covered in step 2
        StepLogger.stepId(3);
        StepLogger.step('Check the screen title.');
        StepLogger.verification('Should display centered on top of the screen the title "MARKETING CAMPAIGNS".');
    });

    // Jira References - COTRAC-4580
    it('Verify if user shall be able to filter the grid list by Owner option - [22416681]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 14:13:50 GMT

        StepLogger.caseId = 22416681;
        StepLogger.stepId(1);
        StepLogger.step('Click on Marketing button menu.');
        await HomePage1Helper.clickOnMarketingMenu();
        StepLogger.verification(`Should expand and the menu and should the options:
        -Marketing List
        -Campaigns`);
        await HomePage1Helper.verifyMarketingSubmenu();

        StepLogger.stepId(2);
        StepLogger.step('Click on Campaigns button.');
        await HomePage1Helper.clickOnCampaignsOption();
        StepLogger.verification('Should display the Marketing Campaigns screen properly.');
        await CampaignsPageHelper.verifyMarketingCampaignsPageDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Select the Owner option in the filter.');
        await CampaignsPageHelper.selectGroupingOption(CampaignsConstant.groupingOptions.owner);
        StepLogger.verification('Should display campaigns type as "Owner" in the grid classified in sections.');
        await CampaignsPageHelper.verifyRecordsAreGrouped(CampaignsConstant.groupingOptions.owner);
    });

    // Jira References - COTRAC-4582
    it('Verify if pagination tools is working properly - [22416686]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 14:13:50 GMT

        StepLogger.caseId = 22416686;
        StepLogger.stepId(1);
        StepLogger.step('Click on Marketing button menu.');
        await HomePage1Helper.clickOnMarketingMenu();
        StepLogger.verification(`Should expand and the menu and should the options:
        -Marketing List
        -Campaigns`);
        await HomePage1Helper.verifyMarketingSubmenu();

        StepLogger.stepId(2);
        StepLogger.step('Click on Campaigns button.');
        await HomePage1Helper.clickOnCampaignsOption();
        StepLogger.verification('Should display the Marketing Campaigns screen properly.');
        await CampaignsPageHelper.verifyMarketingCampaignsPageDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on number 2 in the pagination tools.');
        await CampaignsPageHelper.clickOnPage(Constants.number.two);
        StepLogger.verification('Should load the page 2 items properly.');
        await CampaignsPageHelper.verifyPaginationCurrentPage(Constants.number.two);

        StepLogger.stepId(4);
        StepLogger.step('Click on number 1 in the pagination tools.');
        await CampaignsPageHelper.clickOnPage(Constants.number.one);
        StepLogger.verification('Should load the page 1 items properly.');
        await CampaignsPageHelper.verifyPaginationCurrentPage(Constants.number.one);

        StepLogger.stepId(5);
        StepLogger.step('Click on right arrow ">" in the pagination tools.');
        await CampaignsPageHelper.clickOnNextPageIcon();
        StepLogger.verification('Should load the next items page properly.');
        await CampaignsPageHelper.verifyPaginationCurrentPage(Constants.number.two);

        StepLogger.stepId(6);
        StepLogger.step('Click on left arrow "<" in the pagination tools.');
        await CampaignsPageHelper.clickOnPreviousPageIcon();
        StepLogger.verification('Should load the previous items page properly.');
        await CampaignsPageHelper.verifyPaginationCurrentPage(Constants.number.one);
    });

    // Jira References - COTRAC-4583
    it('Verify if user shall be able to Edit a Marketing Campaign - [22416689]', async () => {
        // Auto generated by aurea-automation - util on Mon, 15 Apr 2019 14:13:50 GMT

        StepLogger.caseId = 22416689;
        StepLogger.stepId(1);
        StepLogger.step('Click on Marketing button menu.');
        await HomePage1Helper.clickOnMarketingMenu();
        StepLogger.verification(`Should expand and the menu and should the options:
        -Marketing List
        -Campaigns`);
        await HomePage1Helper.verifyMarketingSubmenu();

        StepLogger.stepId(2);
        StepLogger.step('Click on Campaigns button.');
        await HomePage1Helper.clickOnCampaignsOption();
        StepLogger.verification('Should display the Marketing Campaigns screen properly.');
        await CampaignsPageHelper.verifyMarketingCampaignsPageDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on "Edit" button.');
        await CampaignsPageHelper.clickOnTheFirstCampaignIcon();
        StepLogger.verification('Should open a new tab with campaign data to edit.');
        await CampaignsPageHelper.verifyCampaignPageDisplayed(false);

        StepLogger.stepId(4);
        StepLogger.step('Edit the data on available fields.');
        const name = PageHelper.getUniqueId();
        await CampaignsPageHelper.typeName(name);
        StepLogger.verification('Should change the field data properly.');
        await CampaignsPageHelper.verifyName(name);

        StepLogger.stepId(5);
        StepLogger.step('Click on "Save" button.');
        await CampaignsPageHelper.clickOnSaveButton();
        StepLogger.verification('Should update the campaign data properly.');
        await CampaignsPageHelper.verifyNewCampaignHasBeenSaved(true, name);

        StepLogger.stepId(6);
        StepLogger.step('Click on "Close" button.');
        await CampaignsPageHelper.clickOnCloseButton();
        StepLogger.verification('Should display a popup confirmation.');
        await CampaignsPageHelper.verifyWarningPopupDisplayed();

        StepLogger.stepId(7);
        StepLogger.step('Click on "OK" button.');
        await CampaignsPageHelper.clickOkButtonOnWarningPopup();
        StepLogger.verification('Should close the tab and show the edit data properly.');
        await CampaignsPageHelper.verifyWarningPopupClosed();
        await CampaignsPageHelper.verifyCreateCampaign(name);
    });
});
