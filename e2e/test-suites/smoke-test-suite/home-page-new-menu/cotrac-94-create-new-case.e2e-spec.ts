import { StepLogger } from '../../../../core/logger/step-logger';
import { PageHelper } from '../../../components/html/page-helper';
import { HomePageHelper } from '../../../page-objects/pages/home-page/home-page.helper';
import { HomePage } from '../../../page-objects/pages/home-page/home-page.po';
import { LoginPageHelper } from '../../../page-objects/pages/login-page/login-page.helper';
import { NewCasePageConstant } from '../../../page-objects/pages/new-case-page/new-case-page.constants';
import { NewCasePageHelper } from '../../../page-objects/pages/new-case-page/new-case-page.helper';
import { SuiteNames } from '../../helpers/suite-names';

describe(SuiteNames.smokeSuite, () => {
    let loginPageHelper: LoginPageHelper;

    beforeAll(async () => {
        loginPageHelper = LoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
    });

    beforeEach(async () => {
        await PageHelper.restartBrowser();
        await loginPageHelper.goTo();
        await LoginPageHelper.loginAsAdmin();
    });

    // Jira References - COTRAC-2909
    it('To verify that user is able to navigate to "New Case" page. - [22397565]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 08:21:44 GMT
        StepLogger.caseId = 22397565;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Verify that case option is displayed under new section.');
        StepLogger.verification('Case should be displayed.');
        await HomePage.newItems.case.verifyDisplayedStatus();

        StepLogger.stepId(3);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed();
    });

    // Jira References - COTRAC-2910
    it('To verify the buttons available on "New Case" page. - [22397571]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 08:30:20 GMT
        StepLogger.caseId = 22397571;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed(false);

        StepLogger.stepId(3);
        StepLogger.step('Verify the button available on new case page.');
        StepLogger.verification('“Save”, “Save and Add” and “Close” buttons should be displayed on top right corner.');
        await NewCasePageHelper.verifySaveCloseSaveAndAddButtonsDisplayed();
    });

    // Jira References - COTRAC-2911
    it('To verify that user lands to Overview Pane when "New Case" is clicked. - [22397573]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 10:01:04 GMT
        StepLogger.caseId = 22397573;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed(false);

        StepLogger.stepId(3);
        StepLogger.step('Verify that only "Overview" pane is displayed.');
        StepLogger.verification('Overview pane is displayed on left panel.');
        await NewCasePageHelper.verifyOnlyOverviewPanel();
    });

    // Jira References - COTRAC-2912
    it('To verify that there are 2 sections on the "New case" page. - [22397578]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 10:18:49 GMT
        StepLogger.caseId = 22397578;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed(false);

        StepLogger.stepId(3);
        StepLogger.step('Verify the sections available in new case page.');
        StepLogger.verification(`Following 2 sections should be available:
            1. Case Data
            2. Resolution`);
        await NewCasePageHelper.verifyCaseDataAndResolutionDisplayed();
    });

    // Jira References - COTRAC-2913
    it('To verify the fields available on "New case" page. - [22397582]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 10:24:56 GMT
        StepLogger.caseId = 22397582;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed(false);

        StepLogger.stepId(3);
        StepLogger.step('Verify the fields available on "New case" page.');
        StepLogger.verification(`The following fields should be available:
            Owner, Contact, Account, Branch, Language, Product, Subject, Description, Category, Contact By, Priority,
            Status and Privacy by Department.`);
        await NewCasePageHelper.verifyOptionsDisplayedUnderCaseData();
    });

    // Jira References - COTRAC-2914
    it('To verify the Owner field defaults to "User". - [22397587]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 10:28:50 GMT
        StepLogger.caseId = 22397587;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed(false);

        StepLogger.stepId(3);
        StepLogger.step('Verify the value in "Owner" field.');
        StepLogger.verification('The default value in owner field should be user.');
        await NewCasePageHelper.verifySelectedOwner(NewCasePageConstant.dropdownOptions.user);
    });

    // Jira References - COTRAC-2915
    it('To verify validation error messages should be displayed when form is left blank and save is clicked. - [22397592]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 10:37:54 GMT
        StepLogger.caseId = 22397592;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed(false);

        StepLogger.stepId(3);
        StepLogger.step('Leaving all the mandatory fields blank, click Save.');
        await NewCasePageHelper.clickSave();
        StepLogger.verification('Validation Error messages should be displayed beside all the mandatory fields.');
        await NewCasePageHelper.verifyValidationErrorMessagesDisplayed();
    });

    // Jira References - COTRAC-2919
    it('To verify that the user should be able to select a contact by clicking "Use Selected Contact" - [22397609]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 10:41:27 GMT
        StepLogger.caseId = 22397609;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed(false);

        StepLogger.stepId(3);
        StepLogger.step('Click search icon besides contact field.');
        await NewCasePageHelper.clickSearchContact();
        StepLogger.verification('Contact locator dialog box should be displayed.');
        await NewCasePageHelper.verifyContactDialog();

        StepLogger.stepId(4);
        StepLogger.step('Enter some data in first name field and Click "Search contacts".');
        const contact = await NewCasePageHelper.enterContactNameAndSearch();
        StepLogger.verification('List of contacts matching the first name are displayed.');
        await NewCasePageHelper.verifySearchedContact(contact);

        StepLogger.stepId(5);
        StepLogger.step('Select a contact from displayed list.');
        await NewCasePageHelper.selectSearchedContact(contact);
        StepLogger.verification('User should be selected.');
        await NewCasePageHelper.verifySearchedContactSelected(contact);

        StepLogger.stepId(6);
        StepLogger.step('Click "Use Selected Contact".');
        await NewCasePageHelper.clickUseSelectedContact();
        StepLogger.verification('The selected contact should be displayed in Contact field.');
        await NewCasePageHelper.verifyContactIsSelected(contact);
    });

    // Jira References - COTRAC-2916
    it('To verify that user is able to save a new case by entering data in mandatory fields - [22397600]', async () => {
        // Auto generated by aurea-automation - util on Wed, 20 Mar 2019 08:36:34 GMT
        StepLogger.caseId = 22397600;
        const subject = `${NewCasePageConstant.elementNames.test}${PageHelper.getUniqueId()}`;

        StepLogger.stepId(1);
        StepLogger.step('Click "New" link displayed in the left panel.');
        await HomePageHelper.clickNewLink();
        StepLogger.verification('Option available under new section should be displayed.');
        await HomePageHelper.verifyOptionsUnderNew();

        StepLogger.stepId(2);
        StepLogger.step('Click "case".');
        await HomePageHelper.clickCaseUnderNew();
        StepLogger.verification('New case page should be displayed.');
        await NewCasePageHelper.verifyNewCasePageDisplayed(false);

        StepLogger.stepId(3);
        StepLogger.step('Search a contact and add.');
        const contact = await NewCasePageHelper.selectContact();
        StepLogger.verification('Contact should be added.');
        await NewCasePageHelper.verifyContactIsSelected(contact);

        StepLogger.stepId(4);
        StepLogger.step('Enter some test subject.');
        await NewCasePageHelper.enterSubject(subject);
        StepLogger.verification('Subject should be entered.');
        await NewCasePageHelper.verifySubjectIsEntered(subject);

        StepLogger.stepId(5);
        StepLogger.step('Enter some test description.');
        await NewCasePageHelper.enterDescription(subject);
        StepLogger.verification('Test description should be added.');
        await NewCasePageHelper.verifyDescriptionIsEntered(subject);

        StepLogger.stepId(6);
        StepLogger.step('Select a category.');
        const option = NewCasePageConstant.dropdownOptions.onlineBanking;
        await NewCasePageHelper.selectCategoryOption(option);
        StepLogger.verification('Category should be selected.');
        await NewCasePageHelper.verifyCategorySelectedOption(option);

        StepLogger.stepId(7);
        StepLogger.step('Enter Sub-category.');
        const subOption = NewCasePageConstant.dropdownOptions.atmDebit;
        await NewCasePageHelper.selectSubCategoryOption(subOption);
        StepLogger.verification('Sub-Category should be added.');
        await NewCasePageHelper.verifySubCategorySelectedOption(subOption);

        StepLogger.stepId(8);
        StepLogger.step('Click "save".');
        await NewCasePageHelper.clickSave();
        StepLogger.verification('Case should be saved.');
        await NewCasePageHelper.verifyCaseIsCreated(subject);
    });
});
